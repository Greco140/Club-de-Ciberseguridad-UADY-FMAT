<h1>
    Introducción
</h1>

En esta ocasión estaremos realizando la máquina Basic Pentesting de TryHackMe, estaremos tocando temas como pruebas de penetración en páginas web y escalada de privilegios. 


<h1>
    Fase de reconocimiento
</h1>

Para esta primera parte haremos los pasos de siempre:
1. Revisar si podemos hacer ping a la máquina víctima.
2. Hacer un escaneo de puertos.
3. Buscar versiones y servicios activos.

<h3>
    Haciendo ping a la máquina víctima
</h3>

![imagen](https://hackmd.io/_uploads/HJMklQkQA.png)

Tenemos conexión y estamos ante una máquina Linux (por el ttl con proximidad a 64)

<h3>
    Escaneando puertos con sus versiones y servicios
</h3>

Encontramos los siguientes puertos abiertos y podemos quedarnos con la siguiente información más importante:

```
# Nmap 7.94SVN scan initiated Sun May 12 23:07:37 2024 as: nmap -p- -sS --open --min-rate=5000 -vvv -sCV -n -Pn -oN escaneo 10.10.91.55
Nmap scan report for 10.10.91.55
Host is up, received user-set (0.23s latency).
Scanned at 2024-05-12 23:07:38 CST for 37s
Not shown: 65529 closed tcp ports (reset)
PORT     STATE SERVICE     REASON         VERSION
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.2p2 Ubntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       syn-ack ttl 63 Apache Jserv (Protocol v1.3)
8080/tcp open  http        syn-ack ttl 63 Apache Tomcat 9.0.7
```

Ahora pasaremos a escanear el puerto 80 (http).


<h2>
    Reconocimiento de directorios y ficheros ocultos
</h2>

Buscaremos directorios ocultos y ficheros con las extensiones .html, .php y .txt:

`gobuster dir -u http://10.10.91.55/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -x .html,.php,.txt`

Hallamos los siguientes ficheros y directorios:
![imagen](https://hackmd.io/_uploads/SkhjLmkQA.png)

Encontramos la respuesta a la **pregunta 3 de TryHackMe:
Respuesta: development**

Entramos a la página http://10.10.91.55/ y solo hallamos lo siguiente:
![imagen](https://hackmd.io/_uploads/ByfswQJm0.png)
De igual forma http://10.10.91.55/index.html nos redirige a la misma página.

En el directorio que hallamos anteriormente (http://10.10.91.55/development) encontramos 2 ficheros de texto:

```
dev.txt

2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```


```
j.txt

For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Por ahora seguiremos recolectando información

<h2>
    Enumerando usuarios
</h2>

Ya que sabemos que la máquina víctima es Linux, usaremos la herramienta enum4linux para enumerar usuarios e información del sistema:

`enum4linux 10.10.91.55`
![imagen](https://hackmd.io/_uploads/r1S4cm1mA.png)
![imagen](https://hackmd.io/_uploads/Hy8Hs71QA.png)
Después de esperar un buen rato hallamos los usuarios jan y kay, que parecen ser los mismos que escribieron los archivos de texto que encontramos anteriormente (por el destinatario y emisor en cada nota).
Con esto respondemos la **pregunta 5 de TryHackMe:
Respuesta: jan**

<h1>
    Fase de intrusión
</h1>

<h2>
    Entrando por ssh con fuerza bruta
</h2>

Ya que conocemos los usuarios, probaremos ingresar por fuerza bruta al usuario jan, ya que en las notas mencionaba kay que era muy fácil crackear su contraseña:

![imagen](https://hackmd.io/_uploads/BJy9RQ1QR.png)
Ahora que tenemos usuario y contraseña del servicio ssh nos conectamos:

`ssh jan@10.10.91.55`
![imagen](https://hackmd.io/_uploads/S1UJkNkQC.png)


**¡Estamos dentro!**

Con esto encontramos la respuesta de las **preguntas 6 y 7 de TryHackMe: 
Respuestas:
armando
ssh**


<h1>
    Escalada de privilegios
</h1>

Navegando un poco por los directorios encontramos un directorio ssh:
![imagen](https://hackmd.io/_uploads/rkUF1V1mC.png)

Copiamos la clave privada en nuestra máquina:
![imagen](https://hackmd.io/_uploads/Hkm4lEJXC.png)



Convertimos la clave privada a un formato legible para johnTheRipper:
`ssh2john.py id_rsa.orig > id_rsa.hash`

Crackeamos la contraseña con:
`john --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt id_rsa.hash`
Y después de esperar un rato encontramos la contraseña

![imagen](https://hackmd.io/_uploads/Sk3NMEkmA.png)

Hemos encontrado la contraseña para usar la clave privada del usuario kay, por lo que la usaremos para entrar por ssh como kay:

Importante: necesitamos entrar siendo usuario jan, no podemos entrar directamente desde nuestra máquina.

Podemos conectarnos con `ssh -i /home/kay/.ssh/id_rsa kay@localhost` y cuando nos pida la contraseña, ingresamos la que encontramos (que es "beeswax")

![imagen](https://hackmd.io/_uploads/HJFp4Ey70.png)

Encontramos la respuesta de la **pregunta 9 de TryHackMe
Respuesta: kay**

Viendo los ficheros en el directorio actual podemos encontrar el fichero `pass.bak` que contiene: **heresareallystrongpasswordthatfollowsthepasswordpolicy$$
siendo la última respuesta de TryHackMe**

![imagen](https://hackmd.io/_uploads/S1W7rE1Q0.png)

Y con eso hemos finalizado la máquina, espero que les haya gustado y hayan podido aprender algo nuevo :p
